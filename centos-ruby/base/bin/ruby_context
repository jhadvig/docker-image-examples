#!/bin/sh

source /opt/ruby/etc/sdk

export GEM_HOME=/opt/ruby/gems
export GEMRC=/opt/ruby/etc/gemrc

# The nodejs010 collection needs to be enabled to make the Rails
# assets compilation works.
#
function scl_env() {
  local collections="ruby193 $(is_nodejs_installed && echo 'nodejs010')"
  /usr/bin/scl enable $collections "printenv $1"
}

# Set the default JavaScript runtime to NodeJS provided V8
# if nodejs is installed.
#
if is_nodejs_installed; then
  export EXECJS_RUNTIME=Node
fi

# FIXME: This is required in order to 'exec' run ruby instead of
#        'scl' command. This have to be fixed in SCL in (near) future.
#
vars=( PATH LD_LIBRARY_PATH PYTHONPATH PKG_CONFIG_PATH )
for var in "${vars[@]}"; do export ${var}=$(scl_env "${var}"); done

cmd="$1" && shift
exec "$cmd" "$@"
